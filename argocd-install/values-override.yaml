configs:
  repositories:
    ekwisnek-github:
      name: ekwisnek-github
      type: git
      url: https://github.com/ekwisnek/argocd.git
    argo-helm:
      name: argo-helm
      type: helm
      url: https://argoproj.github.io/argo-helm
extraObjects:
  - apiVersion: networking.k8s.io/v1
    kind: Ingress
    metadata:
      name: argocd-server-ingress
      namespace: argocd
      annotations:
        cert-manager.io/cluster-issuer: letsencrypt
        kubernetes.io/tls-acme: "true"
    spec:
      ingressClassName: "traefik"
      rules:
        - host: argocd.ctrlplane.net
          http:
            paths:
              - path: /
                pathType: Prefix
                backend:
                  service:
                    name: argocd-server
                    port:
                      name: https
      tls:
        - hosts:
            - argocd.ctrlplane.net
          secretName: argocd-ui-tls
  - apiVersion: argoproj.io/v1alpha1
    kind: AppProject
    metadata:
      name: argocd
      namespace: argocd
    spec:
      description: Argocd Project
      sourceRepos:
      - '*'
      destinations:
      - namespace: argocd
        server: https://kubernetes.default.svc
      clusterResourceWhitelist:
      - group: '*'
        kind: '*'
      orphanedResources:
        warn: false
  - apiVersion: argoproj.io/v1alpha1
    kind: Application
    metadata:
      name: argocd
      namespace: argocd
    spec:
      destination:
        namespace: argocd
        server: https://kubernetes.default.svc
      project: argocd
      sources:
        - helm:
            valueFiles:
            - $values/argocd-install/values-override.yaml
          repoURL: https://argoproj.github.io/argo-helm
          targetRevision: 8.1.2
          chart: argo-cd
        - repoURL: https://github.com/ekwisnek/argocd.git
          ref: values
      syncPolicy:
        syncOptions:
        - CreateNamespace=true
  - apiVersion: argoproj.io/v1alpha1
    kind: Application
    metadata:
      name: argocd-apps
      namespace: argocd
    spec:
      destination:
        namespace: argocd
        server: https://kubernetes.default.svc
      project: argocd
      sources:
        - repoURL: https://github.com/ekwisnek/argocd.git
          targetRevision: HEAD
          path: argocd-apps
          directory:
            recurse: true
      syncPolicy:
        automated:
          selfHeal: true
          prune: true
  - apiVersion: argoproj.io/v1alpha1
    kind: Application
    metadata:
      name: argocd-appprojects
      namespace: argocd
    spec:
      destination:
        namespace: argocd
        server: https://kubernetes.default.svc
      project: argocd
      sources:
        - path: argocd-appprojects
          repoURL: https://github.com/ekwisnek/argocd.git
          targetRevision: HEAD
          directory:
            recurse: true
      syncPolicy:
        automated:
          selfHeal: true
          prune: true
